# Theme App Extension Reference

Theme App Extensions let merchants add dynamic elements to themes without editing theme code. Apps deploy once to all stores, with automatic CDN hosting and theme editor integration.

## Theme Extension Quick Start

```bash
# 1. Copy `theme-extention` in templates folder to `extensions` folder. Ex: cp -r templates/theme-extention extensions/<name>
# 2. Edit TOML name, modify blocks/locales/assets
```

## Directory Structure

```
extensions/<name>/
├── shopify.extension.toml   # Extension config (required)
├── blocks/                  # App blocks and app embed blocks
├── snippets/                # Reusable Liquid components ({% render %})
├── locales/                 # Translation JSON files
│   ├── en.default.json      # English (required)
│   ├── en.default.schema.json  # Schema translations (theme editor)
│   └── <lang>.json          # Other languages
├── assets/                  # CSS, JS, images, fonts
└── package.json             # Node.js dependencies (optional)
```

## TOML Configuration

```toml
name = "my-extension"    # Extension handle
type = "theme"           # Must be "theme"
uid = "auto-generated"   # Generated by Shopify CLI - don't edit manually
```

## Block Types

### App Blocks (`target: "section"`)

Inline content added by merchants to theme sections.

```liquid
{% schema %}
{
  "name": "My Block",
  "target": "section",
  "stylesheet": "block.css",
  "javascript": "block.js",
  "settings": [...]
}
{% endschema %}
```

### App Embed Blocks (`target: "head" | "body" | "compliance_head"`)

Injected before closing tags. For floating/overlay elements.

| Target            | Injected          | Use for                     |
| ----------------- | ----------------- | --------------------------- |
| `head`            | Before `</head>`  | Scripts, styles, meta tags  |
| `body`            | Before `</body>`  | Floating UI, overlays, chat |
| `compliance_head` | First in `<head>` | Cookie consent (critical)   |

## Schema Attributes

### Required

| Attribute | Type   | Description                                  |
| --------- | ------ | -------------------------------------------- |
| `name`    | string | Title in theme editor (max 25 chars)         |
| `target`  | string | `section`, `head`, `body`, `compliance_head` |

### Optional

| Attribute      | Type   | Description                                         |
| -------------- | ------ | --------------------------------------------------- |
| `javascript`   | string | JS file from assets/ (auto-loaded in `<head>`)      |
| `stylesheet`   | string | CSS file from assets/ (auto-loaded in `<head>`)     |
| `enabled_on`   | object | Limit to specific templates/section groups          |
| `disabled_on`  | object | Prevent on specific templates                       |
| `class`        | string | Extra CSS classes (always includes `shopify-block`) |
| `tag`          | string | Wrapping HTML tag (default: `div`)                  |
| `settings`     | array  | Merchant-configurable settings                      |
| `default`      | object | Default setting configuration                       |
| `available_if` | string | Conditional visibility via app metafield            |

### Example with All Features

```liquid
{% schema %}
{
  "name": "Product Reviews",
  "target": "section",
  "stylesheet": "reviews.css",
  "javascript": "reviews.js",
  "class": "reviews-block",
  "tag": "section",
  "enabled_on": { "templates": ["product", "index"] },
  "settings": [
    { "type": "product", "id": "product", "label": "Product", "autofill": true },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#000000" }
  ]
}
{% endschema %}
```

## Setting Types

### Basic Inputs

| Type       | Description      | Example Value      |
| ---------- | ---------------- | ------------------ |
| `checkbox` | Boolean toggle   | `true`             |
| `number`   | Numeric input    | `20`               |
| `radio`    | Single selection | `"option_a"`       |
| `range`    | Slider (min/max) | `50`               |
| `select`   | Dropdown         | `"option_a"`       |
| `text`     | Single line      | `"Hello"`          |
| `textarea` | Multi-line       | `"Line 1\nLine 2"` |

### Resource Selectors

| Type                             | Description                   |
| -------------------------------- | ----------------------------- |
| `article`                        | Blog article                  |
| `blog`                           | Blog                          |
| `collection` / `collection_list` | Single / multiple collections |
| `product` / `product_list`       | Single / multiple products    |
| `image_picker`                   | Image                         |
| `video` / `video_url`            | Video / YouTube/Vimeo URL     |
| `url`                            | URL input                     |

### Specialized

| Type                     | Description                       |
| ------------------------ | --------------------------------- |
| `color` / `color_scheme` | Color picker / theme color scheme |
| `font_picker`            | Font selector                     |
| `html`                   | HTML editor                       |
| `richtext`               | Rich text editor                  |
| `text_alignment`         | Left/center/right                 |

### Setting Properties Example

```json
{
  "type": "number",
  "id": "products_count",
  "label": "Products to show",
  "default": 4,
  "min": 1,
  "max": 20,
  "step": 1,
  "info": "Choose how many products to display"
}
```

## Autofill

Auto-links resource settings to parent section's dynamic source:

```json
{ "type": "product", "id": "product", "label": "Product", "autofill": true }
```

When added to a "Featured product" section, `block.settings.product` auto-points to the section's product.

## Conditional Blocks (`available_if`)

```json
{ "available_if": "{{ app.metafields.features.premium_enabled }}" }
```

Metafield must be boolean type in `app` ownership namespace.

## Locales

### File Types

| File Pattern             | Purpose                                     |
| ------------------------ | ------------------------------------------- |
| `en.default.json`        | Customer-facing translations (required)     |
| `en.default.schema.json` | Theme editor translations (merchant-facing) |
| `<lang>.json`            | Other language translations                 |
| `<lang>.schema.json`     | Other language schema translations          |

### Usage in Liquid

```liquid
{{ 'reviews.title' | t }}
```

## Assets

### Loading Methods

**Schema attributes** (auto-loaded):

```json
{ "stylesheet": "styles.css", "javascript": "app.js" }
```

**Liquid filters** (manual):

```liquid
<link rel="stylesheet" href="{{ 'styles.css' | asset_url }}">
<script src="{{ 'script.js' | asset_url }}" defer></script>
{{ 'image.jpg' | asset_img_url: '500x' }}
```

### Image Sizes (`asset_img_url`)

`small` (100px) | `medium` (240px) | `large` (480px) | `grande` (600px) | Custom: `1024x1024`

## Limits

| Content                     | Limit  |
| --------------------------- | ------ |
| All files in extension      | 10 MB  |
| Number of blocks            | 30     |
| Locale files                | 100    |
| Each locale file            | 15 KB  |
| Liquid across all files     | 100 KB |
| CSS (compressed, suggested) | 100 KB |
| JS (compressed, suggested)  | 10 KB  |

## Deep Linking

### Add App Block

```
https://<shopDomain>/admin/themes/current/editor?template=<template>&addAppBlockId=<api_key>/<handle>&target=<target>
```

- `template`: JSON template (default: `index.json`)
- `api_key`: App's client_id from app.toml
- `handle`: Block filename without `.liquid`
- `target`: `newAppsSection`, `mainSection`, or `sectionGroup:<header|footer|aside>`

### Activate App Embed

```
https://<shopDomain>/admin/themes/current/editor?context=apps&template=<template>&activateAppId=<api_key>/<handle>
```

## Restrictions

- **Not supported on checkout pages**: contact info, shipping, payment, order status
- **Unavailable Liquid objects**: `content_for_header`, `content_for_index`, `content_for_layout`, parent `section` (except `id`)
- **JSON files**: No comments, no trailing commas
